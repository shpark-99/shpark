<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìœ„ì¹˜ ì¸ì¦ ì‹œìŠ¤í…œ</title>
    <style>
        #map {
            width: 100%;
            height: 400px;
        }
        #controls {
            margin-top: 10px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        #statusMessage {
            font-size: 16px;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <h1>ìœ„ì¹˜ ì¸ì¦ ì‹œìŠ¤í…œ</h1>
    <div id="map"></div>
    <div id="controls">
        <input type="text" id="locationInput" placeholder="ê¸°ì¤€ ìœ„ì¹˜ (ì˜ˆ: ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë‚¨êµ¬)">
        <button onclick="setTargetLocation()">ğŸ“ ê¸°ì¤€ ìœ„ì¹˜ ì„¤ì •</button>
        <button onclick="verifyUserLocation()">âœ… ë‚´ ìœ„ì¹˜ ì¸ì¦</button>
        <p id="statusMessage">ğŸ”µ ìœ„ì¹˜ë¥¼ ì„¤ì •í•˜ê³  ì¸ì¦ì„ ì§„í–‰í•˜ì„¸ìš”.</p>
    </div>

    <script type="text/javascript">
        let map;
        let geocoder;
        let targetLocation = null;
        let targetMarker = null;
        let userMarker = null;
        let radiusCircle = null;

        function loadKakaoMap() {
            const script = document.createElement("script");
            script.src = "https://dapi.kakao.com/v2/maps/sdk.js?appkey=a50e768349b68eac92037c8858d7a462&libraries=services,geometry";
            script.async = true;
            script.onload = () => {
                console.log("âœ… ì¹´ì¹´ì˜¤ ì§€ë„ API ë¡œë“œ ì™„ë£Œ!");
                initMap();
            };
            document.head.appendChild(script);
        }

        function initMap() {
            map = new kakao.maps.Map(document.getElementById("map"), {
                center: new kakao.maps.LatLng(37.5665, 126.9780), // ì„œìš¸ ê¸°ë³¸ ìœ„ì¹˜
                level: 5
            });

            geocoder = new kakao.maps.services.Geocoder();
        }

        function setTargetLocation() {
            const address = document.getElementById("locationInput").value;
            if (!address) {
                alert("ğŸš¨ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”!");
                return;
            }

            geocoder.addressSearch(address, function(result, status) {
                if (status === kakao.maps.services.Status.OK) {
                    const latlng = new kakao.maps.LatLng(result[0].y, result[0].x);
                    targetLocation = latlng;

                    if (targetMarker) {
                        targetMarker.setMap(null);
                    }
                    targetMarker = new kakao.maps.Marker({
                        position: targetLocation,
                        map: map
                    });

                    map.setCenter(targetLocation);

                    // ê¸°ì¡´ ì› ì‚­ì œ í›„ ìƒˆ ì› ì¶”ê°€
                    if (radiusCircle) {
                        radiusCircle.setMap(null);
                    }
                    radiusCircle = new kakao.maps.Circle({
                        center: targetLocation,
                        radius: 300, // 300m ë°˜ê²½
                        strokeWeight: 3,
                        strokeColor: "#FF0000",
                        strokeOpacity: 0.8,
                        fillColor: "#FF0000",
                        fillOpacity: 0.2,
                        map: map
                    });

                    alert("âœ… ê¸°ì¤€ ìœ„ì¹˜ ì„¤ì • ì™„ë£Œ!");
                } else {
                    alert("âŒ ì£¼ì†Œ ê²€ìƒ‰ ì‹¤íŒ¨! ì˜¬ë°”ë¥¸ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
                }
            });
        }

        function verifyUserLocation() {
            if (!targetLocation) {
                alert("ğŸš¨ ë¨¼ì € ê¸°ì¤€ ìœ„ì¹˜ë¥¼ ì„¤ì •í•˜ì„¸ìš”!");
                return;
            }

            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        const userLocation = new kakao.maps.LatLng(position.coords.latitude, position.coords.longitude);

                        if (userMarker) {
                            userMarker.setMap(null);
                        }
                        userMarker = new kakao.maps.Marker({
                            position: userLocation,
                            map: map,
                            image: new kakao.maps.MarkerImage(
                                "https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/markerStar.png",
                                new kakao.maps.Size(24, 35)
                            )
                        });

                        map.setCenter(userLocation);
                        checkDistance(userLocation);
                    },
                    function(error) {
                        alert("âŒ ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                        console.error("Geolocation Error: ", error);
                    }
                );
            } else {
                alert("âŒ ì´ ë¸Œë¼ìš°ì €ì—ì„œëŠ” ìœ„ì¹˜ ì •ë³´ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
            }
        }

        function checkDistance(userLocation) {
            if (!kakao.maps || !kakao.maps.geometry || !targetLocation) {
                console.error("âŒ ì§€ë„ APIê°€ ì•„ì§ ë¡œë“œë˜ì§€ ì•Šì•˜ê±°ë‚˜ ê¸°ì¤€ ìœ„ì¹˜ê°€ ì„¤ì •ë˜ì§€ ì•ŠìŒ!");
                return;
            }

            const distance = kakao.maps.geometry.computeDistanceBetween(targetLocation, userLocation);
            console.log(`ğŸ“ ê±°ë¦¬: ${distance.toFixed(2)}m`);

            const statusMessage = document.getElementById("statusMessage");
            if (distance <= 300) {
                alert("âœ… ìœ„ì¹˜ ì¸ì¦ ì„±ê³µ! ê¸°ì¤€ ìœ„ì¹˜ ë°˜ê²½ 300m ì´ë‚´ì…ë‹ˆë‹¤.");
                statusMessage.innerText = "âœ… ì¸ì¦ ì„±ê³µ: ë°˜ê²½ 300m ì´ë‚´ì…ë‹ˆë‹¤.";
                statusMessage.style.color = "green";
            } else {
                alert("âŒ ìœ„ì¹˜ ì¸ì¦ ì‹¤íŒ¨! ê¸°ì¤€ ìœ„ì¹˜ ë°˜ê²½ì„ ë²—ì–´ë‚¬ìŠµë‹ˆë‹¤.");
                statusMessage.innerText = "âŒ ì¸ì¦ ì‹¤íŒ¨: ë°˜ê²½ì„ ë²—ì–´ë‚¬ìŠµë‹ˆë‹¤.";
                statusMessage.style.color = "red";
            }
        }

        window.onload = loadKakaoMap;
    </script>
</body>
</html>

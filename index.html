<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>내 위치 기반 Kakao 지도</title>
    <script type="text/javascript" 
        src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=a50e768349b68eac92037c8858d7a462&libraries=services"></script>
    <style>
        #map {
            width: 100%;
            height: 500px;
        }
        #checkLocation {
            margin-top: 10px;
            padding: 10px;
            font-size: 16px;
            cursor: pointer;
        }
    </style>
</head>
<body>

    <h1>내 위치 기반 카카오 지도</h1>
    <div id="map"></div>
    <button id="checkLocation">내 위치 확인</button>
    <p id="result"></p>

    <script>
        // 카카오 지도 초기화
        const mapContainer = document.getElementById('map'); 
        const mapOption = {
            center: new kakao.maps.LatLng(37.5665, 126.9780), // 기준 위치 (서울 시청)
            level: 5
        };
        const map = new kakao.maps.Map(mapContainer, mapOption);

        // 기준 위치 마커 추가
        const targetLocation = new kakao.maps.LatLng(37.5665, 126.9780); // 기준 위치
        const marker = new kakao.maps.Marker({
            position: targetLocation,
            map: map
        });

        // 거리 계산 함수
        function checkDistance(userLat, userLng) {
            const userLocation = new kakao.maps.LatLng(userLat, userLng);
            const distance = kakao.maps.services.Util.getDistance(targetLocation, userLocation); // 거리 계산

            if (distance <= 300) {
                document.getElementById('result').innerText = "✅ 위치 인증 완료: 반경 300m 이내입니다.";
            } else {
                document.getElementById('result').innerText = "❌ 위치 인증 실패: 반경을 벗어났습니다.";
            }
        }

        // 사용자 위치 가져오기 및 지도 이동
        document.getElementById("checkLocation").addEventListener("click", function() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    const userLat = position.coords.latitude;
                    const userLng = position.coords.longitude;

                    // 지도 중심 이동
                    map.setCenter(new kakao.maps.LatLng(userLat, userLng));

                    // 사용자 위치 마커 추가
                    const userMarker = new kakao.maps.Marker({
                        position: new kakao.maps.LatLng(userLat, userLng),
                        map: map
                    });

                    // 거리 확인
                    checkDistance(userLat, userLng);
                }, function() {
                    alert("위치 정보를 가져올 수 없습니다.");
                });
            } else {
                alert("브라우저가 위치 정보를 지원하지 않습니다.");
            }
        });
    </script>

</body>
</html>

<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìœ„ì¹˜ ì¸ì¦ ì¹´ì¹´ì˜¤ ì§€ë„</title>
    <script type="text/javascript" 
        src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=a50e768349b68eac92037c8858d7a462&libraries=services"></script>
    <style>
        #map {
            width: 100%;
            height: 500px;
        }
        #controls {
            margin: 10px 0;
        }
        #addressInput {
            width: 300px;
            padding: 5px;
            font-size: 14px;
        }
        button {
            padding: 8px;
            font-size: 14px;
            cursor: pointer;
        }
        #statusMessage {
            margin-top: 10px;
            font-size: 16px;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <h1>ì‚¬ìš©ì ì„¤ì • ê¸°ì¤€ ìœ„ì¹˜ ê¸°ë°˜ ì¸ì¦</h1>
    
    <!-- ê¸°ì¤€ ìœ„ì¹˜ ì…ë ¥ ì˜ì—­ -->
    <div id="controls">
        <input type="text" id="addressInput" placeholder="ê¸°ì¤€ ìœ„ì¹˜ ì£¼ì†Œ ì…ë ¥">
        <button id="setLocation">ê¸°ì¤€ ìœ„ì¹˜ ì„¤ì •</button>
    </div>
    
    <div id="map"></div>
    
    <!-- ì¸ì¦ ë²„íŠ¼ -->
    <button id="checkLocation">ë‚´ ìœ„ì¹˜ ì¸ì¦</button>
    
    <!-- ì¸ì¦ ê²°ê³¼ í‘œì‹œ ì˜ì—­ -->
    <p id="statusMessage">ğŸ“ í˜„ì¬ ìƒíƒœ: ê¸°ì¤€ ìœ„ì¹˜ë¥¼ ì„¤ì •í•˜ì„¸ìš”.</p>

    <script>
        let map, geocoder, targetMarker, userMarker, targetLocation = null;
        
        // ì§€ë„ ì´ˆê¸°í™” (ê¸°ë³¸ ìœ„ì¹˜: ì„œìš¸ ì‹œì²­)
        function initMap() {
            const mapContainer = document.getElementById('map'); 
            const mapOption = {
                center: new kakao.maps.LatLng(37.5665, 126.9780), // ì„œìš¸ ì‹œì²­
                level: 5
            };
            map = new kakao.maps.Map(mapContainer, mapOption);
            geocoder = new kakao.maps.services.Geocoder();
        }

        // ê±°ë¦¬ ê³„ì‚° ë° ì¸ì¦ í•¨ìˆ˜
        function checkDistance(userLat, userLng) {
            if (!targetLocation) {
                alert("âŒ ê¸°ì¤€ ìœ„ì¹˜ë¥¼ ë¨¼ì € ì„¤ì •í•˜ì„¸ìš”.");
                return;
            }

            const userLocation = new kakao.maps.LatLng(userLat, userLng);
            const distance = kakao.maps.services.Util.getDistance(targetLocation, userLocation); // ê±°ë¦¬ ê³„ì‚°
            const statusMessage = document.getElementById('statusMessage');

            if (distance <= 300) {
                alert("âœ… ìœ„ì¹˜ ì¸ì¦ ì„±ê³µ! ê¸°ì¤€ ìœ„ì¹˜ ë°˜ê²½ 300m ì´ë‚´ì…ë‹ˆë‹¤.");
                statusMessage.innerText = "âœ… ì¸ì¦ ì„±ê³µ: ë°˜ê²½ 300m ì´ë‚´ì…ë‹ˆë‹¤.";
                statusMessage.style.color = "green";
            } else {
                alert("âŒ ìœ„ì¹˜ ì¸ì¦ ì‹¤íŒ¨! ê¸°ì¤€ ìœ„ì¹˜ ë°˜ê²½ì„ ë²—ì–´ë‚¬ìŠµë‹ˆë‹¤.");
                statusMessage.innerText = "âŒ ì¸ì¦ ì‹¤íŒ¨: ë°˜ê²½ì„ ë²—ì–´ë‚¬ìŠµë‹ˆë‹¤.";
                statusMessage.style.color = "red";
            }
        }

        // ê¸°ì¤€ ìœ„ì¹˜ ë³€ê²½ (ì£¼ì†Œ ì…ë ¥ í›„ ë²„íŠ¼ í´ë¦­)
        document.getElementById("setLocation").addEventListener("click", function() {
            const address = document.getElementById("addressInput").value;
            if (!address) {
                alert("ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
                return;
            }

            geocoder.addressSearch(address, function(result, status) {
                if (status === kakao.maps.services.Status.OK) {
                    targetLocation = new kakao.maps.LatLng(result[0].y, result[0].x);

                    // ê¸°ì¤€ ìœ„ì¹˜ ë§ˆì»¤ ì„¤ì •
                    if (!targetMarker) {
                        targetMarker = new kakao.maps.Marker({
                            position: targetLocation,
                            map: map
                        });
                    } else {
                        targetMarker.setPosition(targetLocation);
                    }

                    map.setCenter(targetLocation);
                    document.getElementById('statusMessage').innerText = `ğŸ“ ê¸°ì¤€ ìœ„ì¹˜ ì„¤ì • ì™„ë£Œ: ${result[0].address_name}`;
                    document.getElementById('statusMessage').style.color = "blue";
                    alert(`âœ… ê¸°ì¤€ ìœ„ì¹˜ ì„¤ì • ì™„ë£Œ! (${result[0].address_name})`);
                } else {
                    alert("ì£¼ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                }
            });
        });

        // ì‚¬ìš©ì ìœ„ì¹˜ ê°€ì ¸ì˜¤ê¸° ë° ì¸ì¦
        document.getElementById("checkLocation").addEventListener("click", function() {
            if (!targetLocation) {
                alert("âŒ ê¸°ì¤€ ìœ„ì¹˜ë¥¼ ë¨¼ì € ì„¤ì •í•˜ì„¸ìš”.");
                return;
            }

            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    const userLat = position.coords.latitude;
                    const userLng = position.coords.longitude;
                    const userLocation = new kakao.maps.LatLng(userLat, userLng);

                    // ì‚¬ìš©ì ìœ„ì¹˜ ë§ˆì»¤ ì„¤ì •
                    if (!userMarker) {
                        userMarker = new kakao.maps.Marker({
                            position: userLocation,
                            map: map
                        });
                    } else {
                        userMarker.setPosition(userLocation);
                    }

                    // ì§€ë„ ì¤‘ì‹¬ ì´ë™
                    map.setCenter(userLocation);

                    // ê±°ë¦¬ í™•ì¸ í›„ ì¸ì¦
                    checkDistance(userLat, userLng);
                }, function() {
                    alert("ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                });
            } else {
                alert("ë¸Œë¼ìš°ì €ê°€ ìœ„ì¹˜ ì •ë³´ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
            }
        });

        // ì§€ë„ ì´ˆê¸°í™” ì‹¤í–‰
        window.onload = initMap;
    </script>

</body>
</html>
